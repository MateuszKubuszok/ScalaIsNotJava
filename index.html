<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Scala is not Java</title>

    <meta name="description" content="Some arguments that Scala code doen not need to look like Java without semicolons" />
    <meta name="author" content="Mateusz Kubuszok" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" />

    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/scalac.css" id="theme" />

    <link rel="stylesheet" href="lib/css/darkula.css" />

    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <div class="slides">

        <section>
          <h1>Scala is not Java</h1>
          <h3><a href="http://kubuszok.pl">Mateusz Kubuszok</a> <b>&gt;</b> <a href="https://scalac.io">Scalac</a></h3>
        </section>

        <section>
          <h2>Agenda</h2>
          <ul>
            <li class="fragment">differences in language</li>
            <li class="fragment">some FP "design patterns"</li>
            <li class="fragment">some OOP design patterns</li>
            <li class="fragment">things that wouldn't work well even in Java</li>
          </ul>
        </section>

        <section>
          <section>
            <h1>Differences in language</h1>
          </section>

          <section>
            <h2>var, val and type inferrence</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">void publish(
    Message message,
    Publisher publisher) {
  Timestamp timestamp = makeTimestamp();
  publisher.send(message, timestamp);
}</code></pre></td>
                <td><pre><code class="hljs scala">def publish(
    message: Message
    publisher: Publisher): Unit = {
  val timestamp = makeTimestamp()
  publisher.send(message, timestamp)
}</code></pre></td>
              </tr>
            </table>
            <aside class="notes">Mention Michael Feathers's Working with a Legacy Code and how we used final to find bugs in code.</aside>
          </section>

          <section>
            <h2>functions</h2>
            <pre><code class="hljs scala">def myFun1(int: Int): String = int.toString
val myFun2: String => String = _.toUpperCase
val myFun3 = myFun1 andThen myFun2
List(1, 2, 3).map(myFun3)</code></pre>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>pattern matching</h2>
            <pre><code class="hljs scala">result match {
  case Left(error)  => handleError(error)
  case Right(value) => handleResult(value)
}</code></pre>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>traits: sealed, ADT, mixins</h2>
            <pre><code class="hljs scala">sealed trait Stack[T]
case object Empty[T] extends Stack[T]
case class Top[T](value: T, next: Stack[T])

class Printer {
  def result: List[Either[String, String]] = ???
  def print: Unit = result.foreach(println)
}
trait ErrorFilter { self: Printer => def result = super.result.filter(_.isRight) }
trait OutputLimiter { self: Printer => def result = super.result.take(20) }
new ResultPrinter with ErrorFilter with OutputLimiter</code></pre>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>immutable data structures</h2>
            <pre><code class="hljs scala">case class Cheese(name: String, weightInG: Double)
val cheese1 = Cheese("Gouda", 12.6)
val cheese2 = cheese1.copy(name = "Cheddar")

val list1 = "a" :: "b" :: "c" :: Nil
val list2 = list1 ++ List("d", "e", "f")</code></pre>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>for comprehension</h2>
            <table>
              <tr>
                <td><pre><code class="hljs scala">for {
  i <- List(1, 2, 3)
  j <- List(4, 5, 6)
  k <- List(7, 8, 9)
} yield i * j * k</code></pre></td>
                <td><pre><code class="hljs scala">List(1, 2, 3) flatMap { i =>
  List(4, 5, 6) flatMap { j =>
    List(7, 8, 9) map { k =>
      i * j * k
    }
  }
}</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>Implicits</h2>
            <pre><code class="hljs scala">implicit val context: ExecutionContext = ...
def asyncResult(implicit ec: ExecutionContext): Future[String] = ???

implicit class StringDecorator(string: String) {
  
  def cleanString = string.toLowerCase.trim
}

trait Nat[N <: Nat]
case object Zero extends Nat[Zero]
case class Succ[N <: Nat](value: N) extends Nat[Nat[N]]
implicit val natZero: Nat[Zero] = Zero
implicit def natSucc[N <: Nat](implicit nat: N): Nat[N] = Succ(n)
implicitly[Nat[Nat[Nat[Nat[Zero]]]]]

def fun1[A, TypeClass[A]](value: A)(implicit: fa: TypeClass[A]): A = ...
def fun2[A : TypeClass](value: A): A = ...</code></pre>
            <aside class="notes"></aside>
          </section>
        </section>

        <section>
          <section>
            <h1>FP design patterns</h1>
            <aside class="notes">andthen, orelse, currying, functor, applicative, monad, arrow, lenses, ADT</aside>
          </section>
          
          <section>
            <h2>function composition</h2>
            <td><pre><code class="hljs scala">def parseXml(input: String): XmlDocument
def getUserDataNode(document: XmlDocument): XmlNode
def extractUserData(node: XmlNode): MyUserData

val extractUserDataFromInput = parseXml andThen
                               getUserDataNode andThen
                               extractUserData

val handleSome: PartialFunction[Option[String], Unit] = {
  case Some(result) => println(s"Result is $result")
}
val handleNone: PartialFunction[Option[String], Unit] = {
  case None => println(s"There is no result")
}

val handleOption = handleSome orElse handleNone</code></pre></td>
            <aside class="notes"></aside>
          </section>
          
          <section>
            <h2>typeclasses</h2>
            <pre><code class="hljs scala">trait MyTypeclass[A] {
  def prettyString(printed: A): String
}

implicit def typeclassForMap[K, V] = new MyTypeclass[Map[K, V]] {
  def prettyString(printed: Map[K, V]) =
    printed map { case (k, v) => s"($k -> $v)" } mkString "; "
}
implicit def typeclassForList[B] = new MyTypeclass[List[B]] {
  def prettyString(printed: List[B]) = s"(${printed mkString ", "})"
}

def printMe[A](toPrint: A)(implicit myTypeClass: MyTypeclass[A]) =
  myTypeClass.prettyString(toPrint)
// alternatively
def printMe[A : MyTypeclass](toPrint: A) =
  implicitly[MyTypeclass[A]].prettyString(toPrint)

printMe(List(1, 2, 3)) // (1, 2, 3)
printMe(Map(1 -> 2, 3 -> 4)) // (1 -> 2); (3 -> 4)</code></pre>
            <aside class="notes"></aside>
          </section>
          
          <section>
            <h2>semigroup</h2>
            <pre><code class="hljs scala">trait Semigroup[A] {
  def combine(a1: A, a2: A): A
}

def listSemigroup[A] = new Semigroup[List[A]] {
  def combine(a1: List[A], a2: List[A]): List[A] = a1 ++ a2
}</code></pre>
            <aside class="notes"></aside>
          </section>
          
          <section>
            <h2>monoid</h2>
            <pre><code class="hljs scala">trait Monoid[A] extends Semigroup[A] {
  def zero: A
}

def listMonoid[A] = new Semigroup[List[A]] {
  def combine(a1: List[A], a2: List[A]): List[A] = a1 ++ a2
  def zero: List[A] = List.empty
}</code></pre>
            <aside class="notes"></aside>
          </section>
          
          <section>
            <h2>functor</h2>
            <pre><code class="hljs scala">trait Functor[F[_]] {
  def map[A, B](f: F[A], fun: A => B): F[B]
}

def listFunctor[A] = new Functor[List] {
  def map[A, B](f: List[A], fun: A => B): List[B] = f map fun
}</code></pre>
            <aside class="notes"></aside>
          </section>
          
          <section>
            <h2>monad</h2>
            <pre><code class="hljs scala">trait Monad[F[_]] extends Functor[F] {
  def unit[A](a: A): F[A]
  def flatMap[A, B](f: F[A], fun: A => F[B]): F[B]
}

def listFunctor[A] = new Monad[List] {
  def map[A, B](f: List[A], fun: A => B): List[B] = f map fun
  def unit[A](a: A): List[A] = List(a)
  def flatMap[A, B](f: List[A], fun: A => List[B]): List[B] = f flatMap fun
}</code></pre>
            <aside class="notes"></aside>
          </section>
          
          <section>
            <h2>other useful concepts</h2>
            <ul>
              <li class="fragment">applicative functors</li>
              <li class="fragment">arrows</li>
              <li class="fragment">lenses</li>
              <li class="fragment">prisms</li>
              <li class="fragment">prisms</li>
              <li class="fragment">recursive schemes</li>
              <li class="fragment">...</li>
            </ul>
            <aside class="notes"></aside>
          </section>
        </section>

        <section>
          <section>
            <h1>OOP design patterns</h1>
            <aside class="notes">decoupling of data vs decoupling of behavior</aside>
          </section>

          <section>
            <h2>abstract factory/factory method</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">class ConfigFactory {

  MyConfig createConfig(
      Boolean isDebug,
      Set&lt;String&gt;: flags) { ... }
}

new ConfigFactory()
    .createConfig(isDebug, flags);
</code></pre></td>
                <td><pre><code class="hljs scala">def createConfig(
    isDebug: Boolean,
    flags: Set[String]): MyConfig = { ... }

createConfig(isDebug, flags)</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>builder</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">StringBuilder sb = new StringBuilder()
for (String line : fileContent) {
  sb.append("line: ")
    .append(line)
    .append("\n");
}
String result = sb.toString;</code></pre></td>
                <td><pre><code class="hljs scala">val result =
fileContent.foldLeft(List.empty[String]) {
  case (result, line) =>
    result :+ "line: " :+ line
} mkString "\n"</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>builder</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">interface MyConfig {
  Boolean isDebig();
  Set&lt;String&gt; getFlags();
}

class MyConfigBuilder {
  MyConfigBuilder setDebug(
      Boolean isDebug) { ... }
  MyConfigBuilder setFlags(
      Set&lt;String&gt; flags) { ... }
  MyConfig build() { ... }
}

new MyConfigBuilder()
    .setDebug(true)
    .setFlags(flags)
    .build();</code></pre></td>
                <td><pre><code class="hljs scala">case class MyConfig(
      isDebug: Boolean = false,
      flags: Set[String] = Set.empty)

MyConfig().copy(isDebug = true, flags = flags)
// or MyConfig(isDebug = true, flags = flags)
// or MyConfig(isDebug = true).copy(flags = flags)
// etc</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>lazy initialization</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">interface X {
  String getResult;
}

class LazyXProxy {
  private X inner = null;

  private X getX() {
    if (inner == null)
      inner = ...;;
    return X;
  }

  String getResult() {
    return getX.getResult();
  }
}</code></pre></td>
                <td><pre><code class="hljs scala">trait X {
  def getResult: String
}

lazy val lazyX: X = ...</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>singleton</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">class Singleton {
  private static Singleton self = null;

  private Singleton() {}

  public static Singleton get() {
    // this should be synchronized!
    if (self == null)
      self = new Singleton();
    return self;
  }
}</code></pre></td>
                <td><pre><code class="hljs scala">object Singleton</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>command object</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">interface Command {
  void execute(target: Data);
}

class UpdateDataCommand extends Command {
  void execute(target: Data) { ... } 
}</code></pre></td>
                <td><pre><code class="hljs scala">trait Command extends (Data => Unit)

case object UpdateData extends Command {
  def apply(target: Data): Unit = { ... }
}</code></pre></td>
              </tr>
            </table>
            <aside class="notes">also mention servant</aside>
          </section>

          <section>
            <h2>observer</h2>
            <ul>
              <li class="fragment">futures</li>
              <li class="fragment">reactive programming in general</li>
              <li class="fragment"><pre><code class="hljs scala">import rx._

val a = Var(1); val b = Var(2)
val c = Rx { a() + b() }
println(c.now) // 3
a() = 4
println(c.now) // 6</code></pre></li>
            </ul>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>decorator</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">interface X {
  String getResult();
}

class XDecorator {
  private X x;
  XDecorator(X x) { this.x = x; }

  String getResult() {
    return x.getResult();
  }

  String getResultUpper() {
    return getResult().toUpperCase();
  }
}</code></pre></td>
                <td><pre><code class="hljs scala">trait X {
  def getResult: String
}

implicit class XDecorator(x: X) {
  def getResultUpper = x.getResult.toUpperCase
}</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>template method</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">abstract class SeriousOperations {
  void doSeriousStuff() {
    // doing things
    String nextResult =
        templateMethod(resultSoFar);
    // doing more things
  }

  abstract String templateMethod(
      String resultSoFar);
}
class Implementation
    extends SeriousOperations {
  String templateMethod(
      String resultSoFar) { ... }
}</code></pre></td>
                <td><pre><code class="hljs scala">def seriousOperations(
  template: String => String
): Unit = {
  // doing things
  val nextResult = template(resultSoFar);
  // doing more things
}</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>strategy</h2>
            <table>
              <tr>
                <td><pre><code class="hljs java">interface PrintStrategy {
  String print(Data data);
}
class XmlPrintStrategy
    extends PrintStrategy {
  String print(Data data) { ... }
}
class JsonPrintStrategy
    extends PrintStrategy {
  String print(Data data) { ... }
}</code></pre></td>
                <td><pre><code class="hljs scala">val printXMl: Data => String = ...
val printJson: Data => String = ...</code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>interpreter</h2>
            <pre><code class="hljs scala">sealed trait CalcDSL[T]
object CalcDSL {
  case class AskForInput(question: String) extends CalcDSL[Integer]
  case class PrintResult(result: String) extends CalcDSL[Unit]
  case class Add(i: Integer, j: Integer) extends CalcDSL[Integer]
  case class Mul(i: Integer, j: Integer) extends CalcDSL[Integer]

  class Ops {
    def askForInput(question: String) = Free.liftF(AskForInput(question))
    def printResult(result: String) = Free.liftF(PrintResult(result))
    def add(i: Integer, j: Integer) = Free.liftF(Add(i: Integer, j: Integer))
    def mul(i: Integer, j: Integer) = Free.liftF(Mul(i: Integer, j: Integer))
  }
}</code></pre>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>interpreter</h2>
            <pre><code class="hljs scala">val interpreter = new (CalcDSL ~> Id) {
              def apply[A](in: CalcDSL[A]): A = in match {
                case AskForInput(question) => println(question); StdIn.readInt()
                case PrintResult(result)   => println(result)
                case Add(i, j)             => i + j
                case Mul(i, j)             => i * j
              }
            }</code></pre>
            <aside class="notes"></aside>
          </section>

          <section>
            <h2>interpreter</h2>
            <pre><code class="hljs scala">val ops = new CalcDSL.Ops
val program = for {
  a <- ops.askForInput("a =")
  b <- ops.askForInput("b =")
  c <- ops.add(a, b)
  _ <- ops.printResult(s"a + b = $c")
  d <- ops.mul(a, b)
  _ <- ops.printResult(s"a * b = $d")
} yield (c, d)

val (c, d) = program.foldMap(interpreter)</code></pre>
            <aside class="notes"></aside>
          </section>

        </section>

        <section>
          <section>
            <h1>macros and type-level</h1>
          </section>

          <section>
            <h2></h2>
            <table>
              <tr>
                <td><pre><code class="hljs java"></code></pre></td>
                <td><pre><code class="hljs scala"></code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

        </section>

        <section>
          <section>
            <h1>good style</h1>
            <aside class="notes">solid, null, deep inheritance, no need of mocks</aside>
          </section>

          <section>
            <h2></h2>
            <table>
              <tr>
                <td><pre><code class="hljs java"></code></pre></td>
                <td><pre><code class="hljs scala"></code></pre></td>
              </tr>
            </table>
            <aside class="notes"></aside>
          </section>

        </section>

        <section>
          <h2>Summary</h2>
          <ul>
            <li class="fragment">S</li>
          </ul>
        </section>

        <section>
          <h2>Questions?</h2>
        </section>

        <section>
          <h2>Thank you!</h2>
        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
